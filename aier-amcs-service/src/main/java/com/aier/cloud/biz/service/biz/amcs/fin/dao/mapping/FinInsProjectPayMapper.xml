<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aier.cloud.biz.service.biz.amcs.fin.dao.FinInsProjectPayMapper">
  <resultMap id="BaseResultMap" type="com.aier.cloud.biz.service.biz.amcs.fin.entity.FinInsProjectPay">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 23 16:34:04 CST 2018.
    --> 
    <id column="ID" jdbcType="DECIMAL" property="id" />
	<result column="CREATOR" jdbcType="DECIMAL" property="creator" />
	<result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate" />
	<result column="MODIFER" jdbcType="DECIMAL" property="modifer" />
	<result column="MODIFY_DATE" jdbcType="TIMESTAMP" property="modifyDate" />
	<result column="HOSP_ID" jdbcType="DECIMAL" property="hospId" />
	<result column="MAIN_ID" jdbcType="DECIMAL" property="mainId" />
	<result column="MONTH_ID" jdbcType="DECIMAL" property="monthId" />
	<result column="SETTLED_BY_PROJECT_PAYMENT" jdbcType="VARCHAR" property="settledByProjectPayment" />
	<result column="REIMBURSEMENT_POLICY" jdbcType="VARCHAR" property="reimbursementPolicy" />
	<result column="TOTAL_INDICATOR" jdbcType="DECIMAL" property="totalIndicator" />
	<result column="ACTUAL_USED_AMOUNT" jdbcType="DECIMAL" property="actualUsedAmount" />
	<result column="EXCEED_REASON" jdbcType="VARCHAR" property="exceedReason" />
	<result column="RECTIFICATION_MEASURES" jdbcType="VARCHAR" property="rectificationMeasures" />
	<result column="FEEDBACK_TO_MANAGEMENT" jdbcType="VARCHAR" property="feedbackToManagement" />
  </resultMap>
  <sql id="BaseColumnList">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 23 16:34:04 CST 2018.
    -->
	CREATOR, CREATE_DATE, MODIFER, MODIFY_DATE, HOSP_ID, ID, MONTH_ID,
	MAIN_ID, SETTLED_BY_PROJECT_PAYMENT, REIMBURSEMENT_POLICY,TOTAL_INDICATOR,ACTUAL_USED_AMOUNT,
	EXCEED_REASON,RECTIFICATION_MEASURES,FEEDBACK_TO_MANAGEMENT
  </sql>
	<sql id="sql_where">
	<trim prefix="WHERE" prefixOverrides="AND | OR">
		<if test="cond.mainId != null">
			and t.main_id = #{cond.mainId}
		</if>
	</trim>
</sql>
	<select id="getAll" resultType="com.aier.cloud.basic.core.base.db.CamelKeyMap">
		select
		<include refid="BaseColumnList"/>
		from T_FIN_INS_PROJECT_PAY t
		<include refid="sql_where"/>
		order by t.create_date desc
	</select>
	<select id="getByMainId" resultType="com.aier.cloud.biz.service.biz.amcs.fin.entity.FinInsProjectPay">
		select
		<include refid="BaseColumnList"/>
		from T_FIN_INS_PROJECT_PAY t
		where main_id = #{mainId}
	</select>

	<select id="lastList" resultType="Map">
		select t.id,t.MONTH_ID,t.MAIN_ID,t.CREATE_DATE,tm.POOLING_AREA,tm.INSURANCE_TYPE
		from t_fin_ins_project_pay t
		inner join (select * from (select ROWNUM AS rn, month_id, max_date from
		   (select month_id,max(create_date) as max_date from t_fin_ins_project_pay where hosp_id=#{hospId} group by month_id order by max_date desc))
		where rn = 1 or rn = 2) sub on t.month_id=sub.month_id
		left join t_fin_ins_main tm on t.main_id = tm.id
		where t.hosp_id=#{hospId}
	</select>
</mapper>