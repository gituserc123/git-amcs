<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aier.cloud.biz.service.biz.amcs.fin.dao.FinInsDipAnalysisMapper">
    <resultMap id="BaseResultMap" type="com.aier.cloud.biz.service.biz.amcs.fin.entity.FinInsDipAnalysis">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Jan 23 16:34:04 CST 2018.
        -->
        <id column="ID" jdbcType="DECIMAL" property="id"/>
        <result column="CREATOR" jdbcType="DECIMAL" property="creator"/>
        <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate"/>
        <result column="MODIFER" jdbcType="DECIMAL" property="modifer"/>
        <result column="MODIFY_DATE" jdbcType="TIMESTAMP" property="modifyDate"/>
        <result column="HOSP_ID" jdbcType="DECIMAL" property="hospId"/>
        <result column="MONTH_ID" jdbcType="DECIMAL" property="monthId"/>
        <result column="MAIN_ID" jdbcType="DECIMAL" property="mainId"/>
        <result column="DISEASE_TYPE" jdbcType="VARCHAR" property="diseaseType"/>
        <result column="GROUP_NAME" jdbcType="VARCHAR" property="groupName"/>
        <result column="GROUP_CODE" jdbcType="VARCHAR" property="groupCode"/>
        <result column="MAIN_DIAGNOSIS_NAME" jdbcType="VARCHAR" property="mainDiagnosisName"/>
        <result column="MAIN_SURGERY_NAME" jdbcType="VARCHAR" property="mainSurgeryName"/>
        <result column="TOTAL_CASES" jdbcType="DECIMAL" property="totalCases"/>
        <result column="ACTUAL_HOSPITALIZATION_COST" jdbcType="DECIMAL" property="actualHospitalizationCost"/>
        <result column="EXPECTED_SETTLEMENT_COST" jdbcType="DECIMAL" property="expectedSettlementCost"/>
        <result column="EXPECTED_BALANCE_AMOUNT" jdbcType="DECIMAL" property="expectedBalanceAmount"/>
        <result column="AVG_ACTUAL_COST" jdbcType="DECIMAL" property="avgActualCost"/>
        <result column="AVG_EXPECTED_SETTLEMENT" jdbcType="DECIMAL" property="avgExpectedSettlement"/>
        <result column="AVG_EXPECTED_BALANCE_AMOUNT" jdbcType="DECIMAL" property="avgExpectedBalanceAmount"/>
        <result column="PROFIT_LOSS_ANALYSIS" jdbcType="VARCHAR" property="profitLossAnalysis"/>
        <result column="ANNUAL_ASSESSMENT_TARGETS" jdbcType="VARCHAR" property="annualAssessmentTargets"/>
        <result column="INSURANCE_PLAN_CATEGORY" jdbcType="DECIMAL" property="insurancePlanCategory"/>
    </resultMap>
    <sql id="BaseColumnList">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Jan 23 16:34:04 CST 2018.
        -->
        CREATOR, CREATE_DATE, MODIFER, MODIFY_DATE, HOSP_ID, MONTH_ID,
        ID, MAIN_ID, DISEASE_TYPE, GROUP_NAME,GROUP_CODE, MAIN_DIAGNOSIS_NAME, MAIN_SURGERY_NAME,
        TOTAL_CASES, ACTUAL_HOSPITALIZATION_COST, EXPECTED_SETTLEMENT_COST, EXPECTED_BALANCE_AMOUNT, AVG_ACTUAL_COST,
        AVG_EXPECTED_SETTLEMENT,INSURANCE_PLAN_CATEGORY,
        AVG_EXPECTED_BALANCE_AMOUNT, PROFIT_LOSS_ANALYSIS, ANNUAL_ASSESSMENT_TARGETS
    </sql>
    <sql id="sql_where">
        <trim prefix="WHERE" prefixOverrides="AND | OR">
            <if test="cond.monthId != null and cond.monthId > 0">
                and t.MONTH_ID = #{cond.monthId}
            </if>
            <if test="cond.hospId != null and cond.hospId > 0">
                and t.HOSP_ID = #{cond.hospId}
            </if>
            <if test="cond.mainId != null and cond.mainId > 0">
                and t.MAIN_ID = #{cond.mainId}
            </if>
        </trim>
    </sql>
    <select id="getAll" resultType="Map">
        select
        t.*,tm.POOLING_AREA
        from T_FIN_INS_DIP_ANALYSIS t left join t_fin_ins_main tm on t.main_id = tm.id
        <include refid="sql_where"/>
        order by t.create_date desc
    </select>
    <select id="getByMainId" resultType="com.aier.cloud.biz.service.biz.amcs.fin.entity.FinInsDipAnalysis">
        select
        <include refid="BaseColumnList"/>
        from T_FIN_INS_DIP_ANALYSIS t
        where main_id = #{mainId}
    </select>

    <select id="lastList" resultType="Map">
        select t.id,t.MONTH_ID,t.MAIN_ID,t.CREATE_DATE,tm.POOLING_AREA,tm.INSURANCE_TYPE,t.DISEASE_TYPE, t.GROUP_NAME, t.GROUP_CODE,
           t.MAIN_DIAGNOSIS_NAME, t.MAIN_SURGERY_NAME,t.TOTAL_CASES, t.ACTUAL_HOSPITALIZATION_COST, t.EXPECTED_SETTLEMENT_COST,
           t.EXPECTED_BALANCE_AMOUNT, t.AVG_ACTUAL_COST,t.AVG_EXPECTED_SETTLEMENT,t.INSURANCE_PLAN_CATEGORY,
           t.AVG_EXPECTED_BALANCE_AMOUNT, t.PROFIT_LOSS_ANALYSIS, t.ANNUAL_ASSESSMENT_TARGETS,t.HOSP_ID
        from t_fin_ins_dip_analysis t
        <!-- inner join (select * from
        (select month_id,max(create_date) as max_date from t_fin_ins_dip_analysis where hosp_id=#{hospId} group by month_id order by max_date desc)
        where rownum=1) sub on t.month_id=sub.month_id -->
        left join t_fin_ins_main tm on t.main_id = tm.id
        where t.hosp_id=#{hospId} and t.create_date between
        to_date(concat(#{paramMonth}, '00:00:00'), 'YYYY-MM-DD hh24:mi:ss')
        and to_date(concat(#{paramCurEndTime}, '23:59:59'), 'YYYY-MM-DD hh24:mi:ss') order by t.CREATE_DATE desc
    </select>

    <select id="lastCommitData" resultMap="BaseResultMap">
        select t.*
        from amcs.t_fin_ins_dip_analysis t
        inner join (select * from (select ROWNUM AS rn, month_id, max_date from
        (select month_id,max(create_date) as max_date from amcs.t_fin_ins_dip_analysis where hosp_id=#{hospId} group by month_id order by max_date desc))
        where rn = 1) sub on t.month_id=sub.month_id
        left join amcs.t_fin_ins_main tm on t.main_id = tm.id
        where t.hosp_id=#{hospId} and t.create_date &lt; TRUNC(CURRENT_DATE, 'MONTH')
    </select>
</mapper>