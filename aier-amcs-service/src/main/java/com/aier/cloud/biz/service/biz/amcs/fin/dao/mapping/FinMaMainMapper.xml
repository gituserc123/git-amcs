<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aier.cloud.biz.service.biz.amcs.fin.dao.FinMaMainMapper">
  <resultMap id="BaseResultMap" type="com.aier.cloud.biz.service.biz.amcs.fin.entity.FinMaMain">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 23 16:34:04 CST 2018.
    --> 
    <id column="ID" jdbcType="DECIMAL" property="id" />
	<result column="MODIFY_DATE" jdbcType="TIMESTAMP" property="modifyDate" />
	<result column="MODIFER" jdbcType="DECIMAL" property="modifer" />
	<result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate" />
	<result column="CREATOR" jdbcType="DECIMAL" property="creator" />
	<result column="INSURANCE_SETTLEMENT_LEVEL" jdbcType="DECIMAL" property="insuranceSettlementLevel" />
	<result column="HEALTH_COMMISSION_LEVEL" jdbcType="DECIMAL" property="healthCommissionLevel" />
	<result column="EHR_LEVEL" jdbcType="VARCHAR" property="ehrLevel" />
	<result column="HOSP_PARENT" jdbcType="VARCHAR" property="hospParent" />
	<result column="INVEST_NATURE" jdbcType="VARCHAR" property="investNature" />
	<result column="HOSP_ID" jdbcType="DECIMAL" property="hospId" />
	<result column="HOSP_NAME" jdbcType="VARCHAR" property="hospName" />
	<result column="MISP_CLEAR_FLAG" jdbcType="DECIMAL" property="mispClearFlag" />
	<result column="INSURANCE_TYPE" jdbcType="DECIMAL" property="insuranceType" />
	<result column="SETTLEMENT_METHOD" jdbcType="VARCHAR" property="settlementMethod" />
	<result column="MA_QUARTER" jdbcType="DECIMAL" property="maQuarter" />
	<result column="MA_YEAR" jdbcType="DECIMAL" property="maYear" />
	<result column="MA_IDENTIFIER" jdbcType="VARCHAR" property="maIdentifier" />
	<result column="BUSI_SIGN" jdbcType="VARCHAR" property="busiSign" />
	<result column="SINGLE_EYE" jdbcType="DECIMAL" property="singleEye" />
  </resultMap>
  <sql id="BaseColumnList">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 23 16:34:04 CST 2018.
    -->
	MODIFY_DATE, MODIFER, CREATE_DATE, CREATOR, INSURANCE_SETTLEMENT_LEVEL, HEALTH_COMMISSION_LEVEL, 	
	EHR_LEVEL, HOSP_PARENT, INVEST_NATURE, HOSP_ID, HOSP_NAME, MISP_CLEAR_FLAG, 	
	INSURANCE_TYPE, SETTLEMENT_METHOD, MA_QUARTER, MA_YEAR, MA_IDENTIFIER, ID

  </sql>

	<sql id="sql_where">
		<trim prefix="WHERE" prefixOverrides="AND | OR">
			1=1
			<if test="cond.id != null and cond.id > 0">
				and t.id = #{cond.id}
			</if>
			<if test="cond.maYear != null">
				and t.ma_year = #{cond.maYear}
			</if>
			<if test="cond.maQuarter != null">
				and t.ma_quarter = #{cond.maQuarter}
			</if>
			<if test="cond.insuranceType != null ">
				and t.insurance_type = #{cond.insuranceType}
			</if>
			<if test="cond.healthCommissionLevel != null ">
				and t.health_commission_level = #{cond.healthCommissionLevel}
			</if>
			<if test="cond.mispClearFlag != null ">
				and t.misp_clear_flag = #{cond.mispClearFlag}
			</if>
			<if test="cond.maIdentifier != null and cond.maIdentifier != ''">
				and t.ma_identifier = #{cond.maIdentifier}
			</if>
			<if test="cond.hospId != null ">
				and t.hosp_id = #{cond.hospId}
			</if>
			<if test="cond.settlementMethod != null and cond.settlementMethod != ''">
				and t.settlement_method = #{cond.settlementMethod}
			</if>
			<if test="cond.hospList != null and cond.hospList.size() > 0">
				and t.HOSP_ID in
				<foreach collection="cond.hospList" index="index" item="item"
						 separator="," open="(" close=")">
					#{item}
				</foreach>
			</if>
		</trim>
	</sql>

	<select id="getAllRecord" resultMap="BaseResultMap">
		select
		<include refid="BaseColumnList"/>
		from T_FIN_MA_MAIN t
		<include refid="sql_where"/>
	</select>

	<select id="getAll" resultMap="BaseResultMap">
		select
		<include refid="BaseColumnList"/>
		from T_FIN_MA_MAIN t
		<include refid="sql_where"/>
	</select>

	<select id="getStatCount" resultType="Integer">
		select count('x')
		from T_FIN_MA_MAIN t
		<include refid="sql_where"/>
	</select>

	<select id="getStatDipRecord" resultMap="BaseResultMap">
		select * from
		(select
			tm.*,tp.single_eye,tp.busi_sign
		from T_FIN_MA_MAIN tm LEFT JOIN T_FIN_MA_DIP_DTL tp on tm.id=tp.MAIN_ID and tp.busi_sign=#{cond.busiSign} and tp.single_eye > 0
		where tm.SETTLEMENT_METHOD = 'DIP' and tm.MISP_CLEAR_FLAG=1 and tm.INSURANCE_TYPE=#{cond.insuranceType} and
		tm.HEALTH_COMMISSION_LEVEL = #{cond.healthCommissionLevel}
		<if test="cond.hospList != null and cond.hospList.size() > 0">
			and tm.HOSP_ID in
			<foreach collection="cond.hospList" index="index" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="cond.maYear != null">
			and tm.ma_year = #{cond.maYear}
		</if>
		<if test="cond.maQuarter != null">
			and tm.ma_quarter = #{cond.maQuarter}
		</if>
		) dip
		where dip.BUSI_SIGN is not null and  dip.SINGLE_EYE is not null
	</select>

	<select id="getStatDrgRecord" resultMap="BaseResultMap">
		select * from
		(select
			tm.*,tg.single_eye,tg.busi_sign
		from T_FIN_MA_MAIN tm LEFT JOIN T_FIN_MA_DRG_DTL tg on tm.id=tg.MAIN_ID and tg.busi_sign=#{cond.busiSign} and tg.single_eye > 0
		where tm.SETTLEMENT_METHOD = 'DRG' and tm.MISP_CLEAR_FLAG=1 and tm.INSURANCE_TYPE=#{cond.insuranceType} and
		tm.HEALTH_COMMISSION_LEVEL = #{cond.healthCommissionLevel}
		<if test="cond.hospList != null and cond.hospList.size() > 0">
			and tm.HOSP_ID in
			<foreach collection="cond.hospList" index="index" item="item"
					 separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="cond.maYear != null">
			and tm.ma_year = #{cond.maYear}
		</if>
		<if test="cond.maQuarter != null">
			and tm.ma_quarter = #{cond.maQuarter}
		</if>
		) drg
		where drg.BUSI_SIGN is not null and  drg.SINGLE_EYE is not null
	</select>

</mapper>