<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aier.cloud.biz.service.biz.amcs.adverse.dao.AeExpertMapper">
  <resultMap id="BaseResultMap" type="com.aier.cloud.biz.service.biz.amcs.adverse.entity.AeExpert">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 23 16:34:04 CST 2018.
    --> 
    <id column="ID" jdbcType="DECIMAL" property="id" />
	<result column="MODIFY_DATE" jdbcType="TIMESTAMP" property="modifyDate" />
	<result column="MODIFER" jdbcType="DECIMAL" property="modifer" />
	<result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate" />
	<result column="CREATOR" jdbcType="DECIMAL" property="creator" />
	<result column="USING_SIGN" jdbcType="DECIMAL" property="usingSign" />
	<result column="HOSP_NAME" jdbcType="VARCHAR" property="hospName" />
	<result column="GROUP_VALUE" jdbcType="DECIMAL" property="groupValue" />
	<result column="STAFF_CODE" jdbcType="VARCHAR" property="staffCode" />
	<result column="STAFF_NAME" jdbcType="VARCHAR" property="staffName" />
	<result column="PROVINCE_CODES" jdbcType="VARCHAR" property="provinceCodes" />
	<result column="STAFF_ID" jdbcType="DECIMAL" property="staffId" />
  </resultMap>
  <sql id="BaseColumnList">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 23 16:34:04 CST 2018.
    -->
	MODIFY_DATE, MODIFER, CREATE_DATE, CREATOR, USING_SIGN, HOSP_NAME, 	
	GROUP_VALUE, STAFF_CODE, STAFF_NAME, STAFF_ID, ID, PROVINCE_CODES
  </sql>
  <select id="findListByCond" resultType="Map">
     select
	  t.id, t.modify_date, t.modifer, t.create_date, t.creator, t.using_sign,
	  t.hosp_name, t.group_value, t.staff_code, t.staff_name, t.province_codes, t.province_names, t.staff_id,
	  count(case when e.is_province = 1 then 1 end) as p_event_count,
	  count(case when e.is_province = 0 then 1 end) as g_event_count
	  from
	  T_AE_EXPERT t
	  left join
	  t_ae_expert_event e on e.expert_id = t.staff_id and e.using_sign = 1
	<include refid="sql_where" />
	  group by t.id, t.modify_date, t.modifer, t.create_date, t.creator, t.using_sign, t.province_names,
	           t.hosp_name, t.group_value, t.staff_code, t.staff_name, t.province_codes, t.staff_id
  </select>
 
  
  <sql id="sql_where">
	<trim prefix="WHERE" prefixOverrides="AND | OR">
		<if test="cond.staffCode != null and cond.staffCode != '' ">
			and t.staff_code= #{cond.staffCode}
		</if>
		<if test="cond.staffKey != null and cond.staffKey != '' ">
			and t.staff_code like concat('%',concat(#{cond.staffKey},'%')) or t.staff_name like concat('%',concat(#{cond.staffKey},'%'))
		</if>
		<if test="cond.groupsValue != null ">
			and BITAND(t.group_value, #{cond.groupsValue}) > 0
		</if>
		<if test="cond.provinceCode != null and cond.provinceCode != '' ">
			and INSTR(',' || t.province_codes || ',', ',' || #{cond.provinceCode} || ',') > 0
		</if>
	</trim>
  </sql>
</mapper>