<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aier.cloud.biz.service.biz.amcs.adverse.dao.AeOperationRecordMapper">
  <resultMap id="BaseResultMap" type="com.aier.cloud.biz.service.biz.amcs.adverse.entity.AeOperationRecord">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 23 16:34:04 CST 2018.
    --> 
    <id column="ID" jdbcType="DECIMAL" property="id" />
	<result column="BASIC_ID" jdbcType="DECIMAL" property="basicId" />
	<result column="HOSP_ID" jdbcType="DECIMAL" property="hospId" />
	<result column="NODE" jdbcType="DECIMAL" property="node" />
	<result column="TYPE" jdbcType="DECIMAL" property="type" />
	<result column="OPINION" jdbcType="VARCHAR" property="opinion" />
	<result column="MODIFER" jdbcType="DECIMAL" property="modifer" />
	<result column="MODIFY_DATE" jdbcType="TIMESTAMP" property="modifyDate" />
  </resultMap>
  <sql id="BaseColumnList">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 23 16:34:04 CST 2018.
    -->
	ID, BASIC_ID, HOSP_ID, NODE, TYPE, OPINION, 	
	MODIFER, MODIFY_DATE 
  </sql>
  <sql id="opinion_sql_where">
	<trim prefix="WHERE" prefixOverrides="AND | OR">
		<if test="cond.type != null">
			and t.TYPE =#{cond.type}
		</if>
		<if  test="cond.basicIds == null and cond.basicId != null">
			and t.BASIC_ID =#{cond.basicId}
		</if>
		<if test="cond.basicIds != null and cond.basicIds.size() > 0">
			and t.BASIC_ID in
			<foreach collection="cond.basicIds" index="index" item="item"
				separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test="cond.types != null and cond.types != '' ">
			and t.type in
			<foreach item="item" index="index" collection="cond.types.split(',')" open="(" separator="," close=")">#{item}</foreach>
		</if>
		<if test="cond.node != null">
			and t.NODE =#{cond.node}
		</if>
	</trim>
  </sql>
  <select id="findOpinionList" resultType="Map">
		select decode(t.node, 1, decode(bi.report_times, 1, '事件上报', '进展上报'),  decode(t.node, 2, '医院', 3, '省区', 4, '集团', 5, '专家', 11, '科主任', '未知')||decode(t.type, 1, '审核通过', 3, '合并', 5, '取消', 6, '退回', 7, '点评', '处理')) as node_name,
		t.ID, t.BASIC_ID, t.HOSP_ID, t.NODE, t.TYPE, t.OPINION, t.MODIFER, t.MODIFY_DATE
		from T_AE_OPERATION_RECORD t left join t_ae_basic_info bi on bi.id = t.basic_id
		<include refid="opinion_sql_where"/>
		order by t.MODIFY_DATE desc
  </select>
</mapper>